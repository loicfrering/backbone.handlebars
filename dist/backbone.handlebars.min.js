// backbone.handlebars v0.2.0
//
// Copyright (c) 2013 Lo√Øc Frering <loic.frering@gmail.com>
// Distributed under the MIT license
(function(){var e=Handlebars.JavaScriptCompiler.prototype.nameLookup;Handlebars.JavaScriptCompiler.prototype.nameLookup=function(t,n,r){return t+".get ? "+t+".get('"+n+"') : "+e.apply(this,arguments)};var t=Backbone.View.extend({render:function(){var e=this.context();_.isString(this.template)&&(this.template=Handlebars.compile(this.template,{knownHelpersOnly:!0}));if(_.isFunction(this.template)){var t=this.template(e,{data:{view:this}});this.$el.html(t)}return this.renderNestedViews(),this},renderNestedViews:function(){_.each(this.nestedViews,function(e,t){this.resolveViewClass(e.name,_.bind(function(n){this.renderNestedView(t,n,e.options)},this))},this)},renderNestedView:function(e,t,n){var r=this.$("#"+e);if(r.size()===1){var i=new t(n);r.replaceWith(i.$el),i.render()}},resolveViewClass:function(e,t){if(_.isFunction(e))return t(e);if(_.isString(e)){var n,r,i,s;n=e.split(".");for(r=0,i=n.length,s=window;r<i;++r)s=s[n[r]];if(s)return t(s);if(typeof require!="undefined")return require([e],t)}throw new Error('Cannot resolve view "'+e+'"')},context:function(){return this.model||this.collection||{}}});Handlebars.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i=0,s="",o,u;t.data&&(o=Handlebars.createFrame(t.data));if(e&&typeof e=="object")if(e instanceof Array||e instanceof Backbone.Collection)for(var a=e.length;i<a;i++)o&&(o.index=i),u=e.at?e.at(i):e[i],s+=n(u,{data:o});else for(var f in e)e.hasOwnProperty(f)&&(o&&(o.key=f),s+=n(e[f],{data:o}),i++);return i===0&&(s=r(this)),s}),uid=1,Handlebars.registerHelper("view",function(e,t){var n="bbhbs-"+uid++;if(!t.data||!t.data.view)throw new Error("A nested view must be defined in a HandlebarsView.");var r=t.data.view;return r.nestedViews=r.nestedViews||{},r.nestedViews[n]={name:e,options:t.hash},new Handlebars.SafeString('<div id="'+n+'"></div>')}),Backbone.HandlebarsView=t})();